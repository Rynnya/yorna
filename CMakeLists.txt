CMAKE_MINIMUM_REQUIRED(VERSION 3.11...3.25)

SET(PROJECT_NAME coffee-editor)
PROJECT(${PROJECT_NAME} CXX)

SET(CMAKE_CXX_STANDARD 17)
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/bin")

FILE(GLOB_RECURSE SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp ${CMAKE_CURRENT_SOURCE_DIR}/include/*.hpp)

FILE(COPY_FILE ${CMAKE_CURRENT_SOURCE_DIR}/libs/imgui-cmake.patch ${CMAKE_CURRENT_SOURCE_DIR}/libs/imgui/CMakeLists.txt)
EXECUTE_PROCESS(COMMAND cd ${CMAKE_CURRENT_SOURCE_DIR}/libs/imgui && git apply ../imgui-config.patch)

ADD_SUBDIRECTORY(engine)
ADD_SUBDIRECTORY(libs/glm)
ADD_SUBDIRECTORY(libs/imgui)
ADD_SUBDIRECTORY(libs/tinyobjloader)

FIND_PACKAGE(Vulkan)

ADD_EXECUTABLE(${PROJECT_NAME} ${SOURCES})
TARGET_INCLUDE_DIRECTORIES(${PROJECT_NAME} PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/engine/include ${CMAKE_CURRENT_SOURCE_DIR}/libs/imgui glm tinyobjloader)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} PRIVATE Vulkan::Vulkan coffee-engine fmt::fmt glfw glm::glm imgui tinyobjloader)
SET_TARGET_PROPERTIES(${PROJECT_NAME} glm imgui tinyobjloader PROPERTIES VS_GLOBAL_VcpkgEnabled FALSE)

ADD_CUSTOM_COMMAND(TARGET ${PROJECT_NAME} PRE_BUILD COMMAND shaders/compile_shaders.bat ${CMAKE_CURRENT_SOURCE_DIR}/shaders)